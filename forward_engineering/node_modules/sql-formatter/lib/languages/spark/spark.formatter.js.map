{"version":3,"file":"spark.formatter.js","names":["reservedSelect","expandPhrases","reservedCommands","reservedSetOperations","reservedJoins","reservedPhrases","SparkFormatter","Tokenizer","reservedDependentClauses","supportsXor","reservedKeywords","keywords","reservedFunctionNames","functions","extraParens","stringTypes","quote","prefixes","identTypes","variableTypes","requirePrefix","operators","postProcess","Formatter","tokens","map","token","i","prevToken","EOF_TOKEN","nextToken","isToken","WINDOW","type","TokenType","OPEN_PAREN","RESERVED_FUNCTION_NAME","text","RESERVED_KEYWORD","IDENTIFIER","raw"],"sources":["../../../src/languages/spark/spark.formatter.ts"],"sourcesContent":["import { expandPhrases } from 'src/expandPhrases';\nimport Formatter from 'src/formatter/Formatter';\nimport Tokenizer from 'src/lexer/Tokenizer';\nimport { EOF_TOKEN, isToken, type Token, TokenType } from 'src/lexer/token';\nimport { keywords } from './spark.keywords';\nimport { functions } from './spark.functions';\n\n// http://spark.apache.org/docs/latest/sql-ref-syntax.html\nconst reservedSelect = expandPhrases(['SELECT [ALL | DISTINCT]']);\n\nconst reservedCommands = expandPhrases([\n  // queries\n  'WITH',\n  'FROM',\n  'WHERE',\n  'GROUP BY',\n  'HAVING',\n  'WINDOW',\n  'ORDER BY',\n  'SORT BY',\n  'CLUSTER BY',\n  'DISTRIBUTE BY',\n  'LIMIT',\n  // Data manipulation\n  // - insert:\n  'INSERT [INTO | OVERWRITE] [TABLE]',\n  'VALUES',\n  // - truncate:\n  'TRUNCATE TABLE',\n  // - insert overwrite directory:\n  //   https://spark.apache.org/docs/latest/sql-ref-syntax-dml-insert-overwrite-directory.html\n  'INSERT OVERWRITE [LOCAL] DIRECTORY',\n  // - load:\n  //   https://spark.apache.org/docs/latest/sql-ref-syntax-dml-load.html\n  'LOAD DATA [LOCAL] INPATH',\n  '[OVERWRITE] INTO TABLE',\n  // Data definition\n  'CREATE [OR REPLACE] [GLOBAL TEMPORARY | TEMPORARY] VIEW [IF NOT EXISTS]',\n  'CREATE [EXTERNAL] TABLE [IF NOT EXISTS]',\n  'DROP TABLE [IF EXISTS]',\n  // - alter table:\n  'ALTER TABLE',\n  'ADD COLUMNS',\n  'DROP {COLUMN | COLUMNS}',\n  'RENAME TO',\n  'RENAME COLUMN',\n  'ALTER COLUMN',\n\n  'ALTER DATABASE',\n  'ALTER VIEW',\n  'CREATE DATABASE',\n  'CREATE FUNCTION',\n  'DROP DATABASE',\n  'DROP FUNCTION',\n  'DROP VIEW',\n  'REPAIR TABLE',\n  'USE DATABASE',\n  // Data Retrieval\n  'TABLESAMPLE',\n  'PIVOT',\n  'TRANSFORM',\n  'EXPLAIN',\n  // Auxiliary\n  'ADD FILE',\n  'ADD JAR',\n  'ANALYZE TABLE',\n  'CACHE TABLE',\n  'CLEAR CACHE',\n  'DESCRIBE DATABASE',\n  'DESCRIBE FUNCTION',\n  'DESCRIBE QUERY',\n  'DESCRIBE TABLE',\n  'LIST FILE',\n  'LIST JAR',\n  'REFRESH',\n  'REFRESH TABLE',\n  'REFRESH FUNCTION',\n  'RESET',\n  'SHOW COLUMNS',\n  'SHOW CREATE TABLE',\n  'SHOW DATABASES',\n  'SHOW FUNCTIONS',\n  'SHOW PARTITIONS',\n  'SHOW TABLE EXTENDED',\n  'SHOW TABLES',\n  'SHOW TBLPROPERTIES',\n  'SHOW VIEWS',\n  'UNCACHE TABLE',\n  // other\n  'LATERAL VIEW',\n]);\n\nconst reservedSetOperations = expandPhrases([\n  'UNION [ALL | DISTINCT]',\n  'EXCEPT [ALL | DISTINCT]',\n  'INTERSECT [ALL | DISTINCT]',\n]);\n\nconst reservedJoins = expandPhrases([\n  'JOIN',\n  '{LEFT | RIGHT | FULL} [OUTER] JOIN',\n  '{INNER | CROSS} JOIN',\n  'NATURAL [INNER] JOIN',\n  'NATURAL {LEFT | RIGHT | FULL} [OUTER] JOIN',\n  // non-standard-joins\n  '[LEFT] {ANTI | SEMI} JOIN',\n  'NATURAL [LEFT] {ANTI | SEMI} JOIN',\n]);\n\nconst reservedPhrases = ['ON DELETE', 'ON UPDATE', 'CURRENT ROW'];\n\n// http://spark.apache.org/docs/latest/sql-programming-guide.html\nexport default class SparkFormatter extends Formatter {\n  static operators = ['~', '<=>', '&&', '||', '==', '->'];\n\n  tokenizer() {\n    return new Tokenizer({\n      reservedCommands,\n      reservedSelect,\n      reservedSetOperations,\n      reservedJoins,\n      reservedDependentClauses: ['WHEN', 'ELSE'],\n      reservedPhrases,\n      supportsXor: true,\n      reservedKeywords: keywords,\n      reservedFunctionNames: functions,\n      extraParens: ['[]'],\n      stringTypes: [\n        { quote: \"''\", prefixes: ['R', 'X'] },\n        { quote: '\"\"', prefixes: ['R', 'X'] },\n      ],\n      identTypes: ['``'],\n      variableTypes: [{ quote: '{}', prefixes: ['$'], requirePrefix: true }],\n      operators: SparkFormatter.operators,\n      postProcess,\n    });\n  }\n}\n\nfunction postProcess(tokens: Token[]) {\n  return tokens.map((token, i) => {\n    const prevToken = tokens[i - 1] || EOF_TOKEN;\n    const nextToken = tokens[i + 1] || EOF_TOKEN;\n\n    // [WINDOW](...)\n    if (isToken.WINDOW(token) && nextToken.type === TokenType.OPEN_PAREN) {\n      // This is a function call, treat it as a reserved function name\n      return { ...token, type: TokenType.RESERVED_FUNCTION_NAME };\n    }\n\n    // TODO: deprecate this once ITEMS is merged with COLLECTION\n    if (token.text === 'ITEMS' && token.type === TokenType.RESERVED_KEYWORD) {\n      if (!(prevToken.text === 'COLLECTION' && nextToken.text === 'TERMINATED')) {\n        // this is a word and not COLLECTION ITEMS\n        return { ...token, type: TokenType.IDENTIFIER, text: token.raw };\n      }\n    }\n\n    return token;\n  });\n}\n"],"mappings":"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"}