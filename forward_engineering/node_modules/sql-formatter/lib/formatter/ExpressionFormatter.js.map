{"version":3,"file":"ExpressionFormatter.js","names":["ExpressionFormatter","cfg","params","layout","inline","inlineBlock","InlineBlock","expressionWidth","nodes","index","length","node","type","NodeType","function_call","formatFunctionCall","array_subscript","formatArraySubscript","parenthesis","formatParenthesis","between_predicate","formatBetweenPredicate","clause","formatClause","set_operation","formatSetOperation","limit_clause","formatLimitClause","all_columns_asterisk","formatAllColumnsAsterisk","token","formatToken","add","show","nameToken","arrayToken","isInlineBlock","openParen","formatSubExpression","children","WS","NO_SPACE","closeParen","SPACE","NEWLINE","isTabularStyle","INDENT","indentation","increaseBlockLevel","decreaseBlockLevel","betweenToken","expr1","showNonTabular","andToken","expr2","increaseTopLevel","decreaseTopLevel","limitToken","offset","count","_node","format","TokenType","LINE_COMMENT","formatLineComment","BLOCK_COMMENT","formatBlockComment","RESERVED_JOIN","formatJoin","RESERVED_DEPENDENT_CLAUSE","formatDependentClause","AND","OR","XOR","formatLogicalOperator","RESERVED_KEYWORD","RESERVED_FUNCTION_NAME","RESERVED_PHRASE","formatKeyword","CASE","formatCaseStart","END","formatCaseEnd","COMMA","formatComma","OPERATOR","ASTERISK","formatOperator","IDENTIFIER","QUOTED_IDENTIFIER","STRING","NUMBER","VARIABLE","NAMED_PARAMETER","QUOTED_PARAMETER","NUMBERED_PARAMETER","POSITIONAL_PARAMETER","formatLiteral","Error","test","precedingWhitespace","MANDATORY_NEWLINE","NO_NEWLINE","splitBlockComment","text","forEach","line","comment","split","map","replace","language","denseOperators","logicalOperatorNewline","formatMultilineBlockEnd","isTabularToken","toTabularFormat","showToken","indentStyle","isReserved","keywordCase","equalizeWhitespace","raw","toLowerCase","isParameter","get"],"sources":["../../src/formatter/ExpressionFormatter.ts"],"sourcesContent":["import type { FormatOptions } from 'src/FormatOptions';\nimport { equalizeWhitespace } from 'src/utils';\n\nimport Params from 'src/formatter/Params';\nimport { isTabularStyle } from 'src/formatter/config';\nimport { isReserved, type Token, TokenType, isParameter } from 'src/lexer/token';\nimport {\n  AllColumnsAsterisk,\n  ArraySubscript,\n  AstNode,\n  BetweenPredicate,\n  SetOperation,\n  Clause,\n  FunctionCall,\n  LimitClause,\n  NodeType,\n  Parenthesis,\n} from 'src/parser/ast';\n\nimport InlineBlock from './InlineBlock';\nimport Layout, { WS } from './Layout';\nimport toTabularFormat, { isTabularToken } from './tabularStyle';\n\ninterface ExpressionFormatterParams {\n  cfg: FormatOptions;\n  params: Params;\n  layout: Layout;\n  inline?: boolean;\n}\n\n/** Formats a generic SQL expression */\nexport default class ExpressionFormatter {\n  private cfg: FormatOptions;\n  private inlineBlock: InlineBlock;\n  private params: Params;\n  private layout: Layout;\n\n  private inline = false;\n  private nodes: AstNode[] = [];\n  private index = -1;\n\n  constructor({ cfg, params, layout, inline = false }: ExpressionFormatterParams) {\n    this.cfg = cfg;\n    this.inline = inline;\n    this.inlineBlock = new InlineBlock(this.cfg.expressionWidth);\n    this.params = params;\n    this.layout = layout;\n  }\n\n  public format(nodes: AstNode[]): Layout {\n    this.nodes = nodes;\n\n    for (this.index = 0; this.index < this.nodes.length; this.index++) {\n      const node = this.nodes[this.index];\n      switch (node.type) {\n        case NodeType.function_call:\n          this.formatFunctionCall(node);\n          break;\n        case NodeType.array_subscript:\n          this.formatArraySubscript(node);\n          break;\n        case NodeType.parenthesis:\n          this.formatParenthesis(node);\n          break;\n        case NodeType.between_predicate:\n          this.formatBetweenPredicate(node);\n          break;\n        case NodeType.clause:\n          this.formatClause(node);\n          break;\n        case NodeType.set_operation:\n          this.formatSetOperation(node);\n          break;\n        case NodeType.limit_clause:\n          this.formatLimitClause(node);\n          break;\n        case NodeType.all_columns_asterisk:\n          this.formatAllColumnsAsterisk(node);\n          break;\n        case NodeType.token:\n          this.formatToken(node.token);\n          break;\n      }\n    }\n    return this.layout;\n  }\n\n  private formatFunctionCall(node: FunctionCall) {\n    this.layout.add(this.show(node.nameToken));\n    this.formatParenthesis(node.parenthesis);\n  }\n\n  private formatArraySubscript(node: ArraySubscript) {\n    this.layout.add(this.show(node.arrayToken));\n    this.formatParenthesis(node.parenthesis);\n  }\n\n  private formatParenthesis(node: Parenthesis) {\n    const inline = this.inlineBlock.isInlineBlock(node);\n\n    if (inline) {\n      this.layout.add(node.openParen);\n      this.layout = this.formatSubExpression(node.children, inline);\n      this.layout.add(WS.NO_SPACE, node.closeParen, WS.SPACE);\n    } else {\n      this.layout.add(node.openParen, WS.NEWLINE);\n\n      if (isTabularStyle(this.cfg)) {\n        this.layout.add(WS.INDENT);\n        this.layout = this.formatSubExpression(node.children, inline);\n      } else {\n        this.layout.indentation.increaseBlockLevel();\n        this.layout.add(WS.INDENT);\n        this.layout = this.formatSubExpression(node.children, inline);\n        this.layout.indentation.decreaseBlockLevel();\n      }\n\n      this.layout.add(WS.NEWLINE, WS.INDENT, node.closeParen, WS.SPACE);\n    }\n  }\n\n  private formatBetweenPredicate(node: BetweenPredicate) {\n    this.layout.add(this.show(node.betweenToken), WS.SPACE);\n    this.layout = this.formatSubExpression(node.expr1);\n    this.layout.add(WS.NO_SPACE, WS.SPACE, this.showNonTabular(node.andToken), WS.SPACE);\n    this.layout = this.formatSubExpression(node.expr2);\n    this.layout.add(WS.SPACE);\n  }\n\n  private formatClause(node: Clause) {\n    if (isTabularStyle(this.cfg)) {\n      this.layout.add(WS.NEWLINE, WS.INDENT, this.show(node.nameToken), WS.SPACE);\n    } else {\n      this.layout.add(WS.NEWLINE, WS.INDENT, this.show(node.nameToken), WS.NEWLINE);\n    }\n    this.layout.indentation.increaseTopLevel();\n\n    if (!isTabularStyle(this.cfg)) {\n      this.layout.add(WS.INDENT);\n    }\n    this.layout = this.formatSubExpression(node.children);\n\n    this.layout.indentation.decreaseTopLevel();\n  }\n\n  private formatSetOperation(node: SetOperation) {\n    this.layout.add(WS.NEWLINE, WS.INDENT, this.show(node.nameToken), WS.NEWLINE);\n\n    this.layout.add(WS.INDENT);\n    this.layout = this.formatSubExpression(node.children);\n  }\n\n  private formatLimitClause(node: LimitClause) {\n    this.layout.add(WS.NEWLINE, WS.INDENT, this.show(node.limitToken));\n    this.layout.indentation.increaseTopLevel();\n\n    if (node.offset) {\n      this.layout.add(WS.NEWLINE, WS.INDENT);\n      this.layout = this.formatSubExpression(node.offset);\n      this.layout.add(WS.NO_SPACE, ',', WS.SPACE);\n      this.layout = this.formatSubExpression(node.count);\n    } else {\n      this.layout.add(WS.NEWLINE, WS.INDENT);\n      this.layout = this.formatSubExpression(node.count);\n    }\n    this.layout.indentation.decreaseTopLevel();\n  }\n\n  private formatAllColumnsAsterisk(_node: AllColumnsAsterisk) {\n    this.layout.add('*', WS.SPACE);\n  }\n\n  private formatSubExpression(nodes: AstNode[], inline = this.inline): Layout {\n    return new ExpressionFormatter({\n      cfg: this.cfg,\n      params: this.params,\n      layout: this.layout,\n      inline,\n    }).format(nodes);\n  }\n\n  private formatToken(token: Token): void {\n    switch (token.type) {\n      case TokenType.LINE_COMMENT:\n        return this.formatLineComment(token);\n      case TokenType.BLOCK_COMMENT:\n        return this.formatBlockComment(token);\n      case TokenType.RESERVED_JOIN:\n        return this.formatJoin(token);\n      case TokenType.RESERVED_DEPENDENT_CLAUSE:\n        return this.formatDependentClause(token);\n      case TokenType.AND:\n      case TokenType.OR:\n      case TokenType.XOR:\n        return this.formatLogicalOperator(token);\n      case TokenType.RESERVED_KEYWORD:\n      case TokenType.RESERVED_FUNCTION_NAME:\n      case TokenType.RESERVED_PHRASE:\n        return this.formatKeyword(token);\n      case TokenType.CASE:\n        return this.formatCaseStart(token);\n      case TokenType.END:\n        return this.formatCaseEnd(token);\n      case TokenType.COMMA:\n        return this.formatComma(token);\n      case TokenType.OPERATOR:\n      case TokenType.ASTERISK:\n        return this.formatOperator(token);\n      case TokenType.IDENTIFIER:\n      case TokenType.QUOTED_IDENTIFIER:\n      case TokenType.STRING:\n      case TokenType.NUMBER:\n      case TokenType.VARIABLE:\n      case TokenType.NAMED_PARAMETER:\n      case TokenType.QUOTED_PARAMETER:\n      case TokenType.NUMBERED_PARAMETER:\n      case TokenType.POSITIONAL_PARAMETER:\n        return this.formatLiteral(token);\n      default:\n        throw new Error(`Unexpected token type: ${token.type}`);\n    }\n  }\n\n  /** Default formatting for most token types */\n  private formatLiteral(token: Token) {\n    this.layout.add(this.show(token), WS.SPACE);\n  }\n\n  /** Formats a line comment onto query */\n  private formatLineComment(token: Token) {\n    if (/\\n/.test(token.precedingWhitespace || '')) {\n      this.layout.add(WS.NEWLINE, WS.INDENT, this.show(token), WS.MANDATORY_NEWLINE, WS.INDENT);\n    } else {\n      this.layout.add(WS.NO_NEWLINE, WS.SPACE, this.show(token), WS.MANDATORY_NEWLINE, WS.INDENT);\n    }\n  }\n\n  /** Formats a block comment onto query */\n  private formatBlockComment(token: Token) {\n    this.splitBlockComment(token.text).forEach(line => {\n      this.layout.add(WS.NEWLINE, WS.INDENT, line);\n    });\n    this.layout.add(WS.NEWLINE, WS.INDENT);\n  }\n\n  // Breaks up block comment to multiple lines.\n  // For example this comment (dots representing leading whitespace):\n  //\n  //   ..../**\n  //   .....* Some description here\n  //   .....* and here too\n  //   .....*/\n  //\n  // gets broken to this array (note the leading single spaces):\n  //\n  //   [ '/**',\n  //     '.* Some description here',\n  //     '.* and here too',\n  //     '.*/' ]\n  //\n  private splitBlockComment(comment: string): string[] {\n    return comment.split(/\\n/).map(line => {\n      if (/^\\s*\\*/.test(line)) {\n        return ' ' + line.replace(/^\\s*/, '');\n      } else {\n        return line.replace(/^\\s*/, '');\n      }\n    });\n  }\n\n  private formatJoin(token: Token) {\n    if (isTabularStyle(this.cfg)) {\n      // in tabular style JOINs are at the same level as clauses\n      this.layout.indentation.decreaseTopLevel();\n      this.layout.add(WS.NEWLINE, WS.INDENT, this.show(token), WS.SPACE);\n      this.layout.indentation.increaseTopLevel();\n    } else {\n      this.layout.add(WS.NEWLINE, WS.INDENT, this.show(token), WS.SPACE);\n    }\n  }\n\n  /**\n   * Formats a Reserved Keyword onto query\n   */\n  private formatKeyword(token: Token) {\n    this.layout.add(this.show(token), WS.SPACE);\n  }\n\n  /**\n   * Formats a Reserved Dependent Clause token onto query, supporting the keyword that precedes it\n   */\n  private formatDependentClause(token: Token) {\n    this.layout.add(WS.NEWLINE, WS.INDENT, this.show(token), WS.SPACE);\n  }\n\n  /**\n   * Formats an Operator onto query, following rules for specific characters\n   */\n  private formatOperator(token: Token) {\n    // special operator\n    if (token.text === ':') {\n      this.layout.add(WS.NO_SPACE, this.show(token), WS.SPACE);\n      return;\n    } else if (token.text === '.' || token.text === '::') {\n      this.layout.add(WS.NO_SPACE, this.show(token));\n      return;\n    }\n    // special case for PLSQL @ dblink syntax\n    else if (token.text === '@' && this.cfg.language === 'plsql') {\n      this.layout.add(WS.NO_SPACE, this.show(token));\n      return;\n    }\n\n    // other operators\n    if (this.cfg.denseOperators) {\n      this.layout.add(WS.NO_SPACE, this.show(token));\n    } else {\n      this.layout.add(this.show(token), WS.SPACE);\n    }\n  }\n\n  /**\n   * Formats a Logical Operator onto query, joining boolean conditions\n   */\n  private formatLogicalOperator(token: Token) {\n    if (this.cfg.logicalOperatorNewline === 'before') {\n      if (isTabularStyle(this.cfg)) {\n        // In tabular style AND/OR is placed on the same level as clauses\n        this.layout.indentation.decreaseTopLevel();\n        this.layout.add(WS.NEWLINE, WS.INDENT, this.show(token), WS.SPACE);\n        this.layout.indentation.increaseTopLevel();\n      } else {\n        this.layout.add(WS.NEWLINE, WS.INDENT, this.show(token), WS.SPACE);\n      }\n    } else {\n      this.layout.add(this.show(token), WS.NEWLINE, WS.INDENT);\n    }\n  }\n\n  private formatCaseStart(token: Token) {\n    this.layout.indentation.increaseBlockLevel();\n    this.layout.add(this.show(token), WS.NEWLINE, WS.INDENT);\n  }\n\n  private formatCaseEnd(token: Token) {\n    this.formatMultilineBlockEnd(token);\n  }\n\n  private formatMultilineBlockEnd(token: Token) {\n    this.layout.indentation.decreaseBlockLevel();\n\n    this.layout.add(WS.NEWLINE, WS.INDENT, this.show(token), WS.SPACE);\n  }\n\n  /**\n   * Formats a comma Operator onto query, ending line unless in an Inline Block\n   */\n  private formatComma(token: Token) {\n    if (!this.inline) {\n      this.layout.add(WS.NO_SPACE, this.show(token), WS.NEWLINE, WS.INDENT);\n    } else {\n      this.layout.add(WS.NO_SPACE, this.show(token), WS.SPACE);\n    }\n  }\n\n  private show(token: Token): string {\n    if (isTabularToken(token)) {\n      return toTabularFormat(this.showToken(token), this.cfg.indentStyle);\n    } else {\n      return this.showToken(token);\n    }\n  }\n\n  // Like show(), but skips tabular formatting\n  private showNonTabular(token: Token): string {\n    return this.showToken(token);\n  }\n\n  // don't call this directly, always use show() or showNonTabular() instead.\n  private showToken(token: Token): string {\n    if (isReserved(token)) {\n      switch (this.cfg.keywordCase) {\n        case 'preserve':\n          return equalizeWhitespace(token.raw);\n        case 'upper':\n          return token.text;\n        case 'lower':\n          return token.text.toLowerCase();\n      }\n    } else if (isParameter(token)) {\n      return this.params.get(token);\n    } else {\n      return token.text;\n    }\n  }\n}\n"],"mappings":"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"}